<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
	<head>
		<title>DynamicKeypad \ Learning \ Wiring</title>
		
		<link rel="icon" href="img/wiring-1.ico" type="image/x-icon" />
		<link rel="shortcut icon" href="img/wiring-1.ico" type="image/x-icon" />
		
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="Author" content="Hernando Barragán" />
		<meta name="Publisher" content="Wiring" />
		<meta name="Keywords" content="Wiring, Processing, Interactive Media, Electronic Arts, Programming, C, C++, Hernando Barragán" />
		<meta name="Description" content="Wiring is an electronic sketchbook and hardware electronics for developing 
				ideas. It is a context for learning fundamentals of computer programming and prototyping with electronics
				within the context of the electronic arts." />
		<meta name="Copyright" content="All contents copyright Hernando Barragán" />
		
		<script src="../../javascript/MM_functions.js" type="text/javascript"></script>
	
		<link href="../../css/style.css" rel="stylesheet" type="text/css" />
	</head>
	<body id="Library" onload="" >
		
		<!-- ==================================== PAGE ============================ --> 
		<div id="container">
	
			<!-- ==================================== HEADER ============================ --> 
			<div id="header">
				<a href="../../index.html"><img src="../../img/wiring_cover.gif" alt="Wiring cover" title="Back to the reference index." /></a>
				<form name="search" method="get" action="http://www.google.com/search">
				<label>Search wiring.org.co:</label> 
				       <p><input type="hidden" name="as_sitesearch" value="wiring.org.co" />
				       <input type="text" name="as_q" value="" size="20" class="text" /> 
						<input type="image" src="../../img/search_button.gif" value="Submit" alt="Submit" /></p>
				</form>
			</div> 
						<div id="navigation">
				<div class="navBar" id="mainnav">
					<a href="../../index.html">Framework</a> (<a href="../../alpha.html">A-Z</a>) \ 
					<a href="../../libraries/index.html">Libraries</a> \ 
					<a href="../../environment/index.html">Environment</a> \ 
					<a href="../../learning/index.html" class="active">Learning</a> \
					<a href="../../hardware/index.html">Hardware</a> 
				</div>
				<div class="navBar learning_local" id="subNav">
					 
 Examples: 					<a href="../../learning/basics/index.html">Basics</a>, 
					<a href="../../learning/libraries/index.html" class="active">Library</a>, 
					<a href="../../learning/topics/index.html">Topics</a> 
				</div>
			</div>

		
			<a id="TOP" name="TOP"></a>
			
			<!-- ==================================== CONTENT - Headers ============================ -->
			<div class="content">
			 
			 
<div class="examples-nav-div">
<table width="480" border="0"><tr><td align="left"><table>
<tr><td><a href="customkeypad.html">
				<img src="../../img/back_off.gif" alt="Custom Keypad" /></a></td><td>
<select name="nav" size="1" class="inputnav" onChange="javascript:gogo(this)">
	<optgroup label="Wire">
		<option value="digitalpotentiometer.html">Digital potentiometer: AD5171</option>
		<option value="masterreader.html">Master reader</option>
		<option value="masterwriter.html">Master writer</option>
		<option value="slavereceiver.html">Slave receiver</option>
		<option value="slavesender.html">Slave sender</option>
		<option value="ultrasonicsfr.html">Ultrasonic ranger: SFR08/SFR10</option>
		<option value="hmc6352sparkfun.html">Compass heading: HMC6352 sparkfun</option>
		<option value="hmc6343sparkfun.html">Compass heading with tilt compensation: HMC6352 sparkfun</option>
		<option value="realtimeclock.html">Real time clock: DS1307 sparkfun</option>
		<option value="bmp085.html">Temperature and barometric pressure: Sparkfun BOSCH BMP085</option>
		<option value="tmp102sparkfun.html">Temperature: Sparkfun tmp102</option>
	</optgroup>
	<optgroup label="SPI">
		<option value="barometricpressuresensor.html">Barometric pressure: SCP1000</option>
		<option value="gyromlx90609.html">MLX90609 Gyroscope: Sparkfun</option>
	</optgroup>
	<optgroup label="Servo">
		<option value="servomotor.html">Servo moving</option>
		<option value="servomultiple.html">Multiple servos</option>
		<option value="servoanaloginput.html">Servo & potentiometer</option>
	</optgroup>
	<optgroup label="Matrix">
		<option value="hellomatrix.html">Hello Matrix</option>
		<option value="spriteanimation.html">Sprite animation</option>
	</optgroup>
	<optgroup label="LiquidCrystal">
		<option value="printdata.html">Printing data to parallel LCD display</option>
	</optgroup>
	<optgroup label="Encoder">
		<option value="encoderread.html">Encoder read</option>
	</optgroup>
	<optgroup label="EEPROM">
		<option value="storedata.html">Storing data</option>
	</optgroup>
	<optgroup label="EEPROMVar">
		<option value="helloeepromvar.html">EEPROM data variables</option>
	</optgroup>
	<optgroup label="Firmata">
		<option value="allinputsfirmata.html">All inputs</option>
		<option value="analogfirmata.html">Analog inputs</option>
		<option value="echostring.html">Strings accept and echoing</option>
		<option value="i2cfirmata.html">Wire & Firmata</option>
		<option value="oldstandardfirmata.html">Old Standard protocol</option>
		<option value="servofirmata.html">Servo & Firmata</option>
		<option value="simpleanalogfirmata.html">Analog input/output pins</option>
		<option value="simpledigitalfirmata.html">Digital input/output pins</option>
		<option value="standardfirmata.html">Standard protocol</option>
	</optgroup>
	<optgroup label="NewSoftSerial">
		<option value="newsoftserialtest.html">Software serial port test</option>
		<option value="twonsstest.html">Two ports</option>
	</optgroup>
	<optgroup label="Stepper">
		<option value="steppermove.html">Stepper move</option>
	</optgroup>
	<optgroup label="NMEA">
		<option value="basicpositioning.html">Basic positioning</option>
		<option value="coursetodestination.html">Course to destination</option>
		<option value="determiningspeed.html">Determining speed</option>
		<option value="distancetodestination.html">Distance to destination</option>
		<option value="nmeasentence.html">NMEA Sentence</option>
	</optgroup>
	<optgroup label="Button">
		<option value="button.html">Button object</option>
		<option value="eventbutton.html">Event API for buttons</option>
		<option value="pollingcomplexbutton.html">Button polling technique</option>
	</optgroup>
	<optgroup label="Constrain">
		<option value="simpleconstrain.html">Constrained variables</option>
	</optgroup>
	<optgroup label="FluentPrint">
		<option value="hellofluentprint.html">Hello fluent print</option>
	</optgroup>
	<optgroup label="FSM">
		<option value="ledstatemachine.html">LED state machine</option>
	</optgroup>
	<optgroup label="HashMap">
		<option value="hellohashmap.html">Hello Hashmap</option>
	</optgroup>
	<optgroup label="Keypad">
		<option value="customkeypad.html">Custom Keypad</option>
		<option value="dynamickeypad.html" selected="selected">Dynamic Keypad</option>
		<option value="eventkeypad.html">Event Keypad</option>
		<option value="hellokeypad.html">Hello Keypad</option>
	</optgroup>
	<optgroup label="LED">
		<option value="blink.html">Blink</option>
		<option value="loop.html">Loop</option>
	</optgroup>
	<optgroup label="MenuBackend">
		<option value="hellomenu.html">Hello Menu</option>
	</optgroup>
	<optgroup label="OSC">
		<option value="helloosc.html">Hello OSC (Open Sound Control)</option>
	</optgroup>
	<optgroup label="Messenger">
		<option value="basic_communication.html">Basic communication</option>
		<option value="checkstring.html">Check string</option>
		<option value="copystring.html">Copy string</option>
	</optgroup>
	<optgroup label="Password">
		<option value="hellopassword.html">Hello Password</option>
		<option value="passwordkeypad.html">Password Keypad</option>
		<option value="serialmonitor.html">Serial Monitor</option>
	</optgroup>
	<optgroup label="Potentiometer">
		<option value="potcontrol_led.html">PotControl LED</option>
		<option value="potdemo.html">Pot Demo</option>
	</optgroup>
	<optgroup label="Scheduler">
		<option value="delayedsignal.html">Delayed Signal</option>
	</optgroup>
	<optgroup label="Supervisor">
		<option value="hellosupervisor.html">Hello Supervisor</option>
	</optgroup>
	<optgroup label="TimedAction">
		<option value="hellotimedaction.html">Hello Timed Action</option>
		<option value="threeexamplesatonce.html">Three Examples At Once</option>
	</optgroup>
</select>

</td><td><a class="next" href="eventkeypad.html">
				<img src="../../img/next_off.gif" alt="Event Keypad" /></a></td></tr></table></td></tr></table></div>

<p class="ref-notice">This example is for Wiring version 1.0 build 0100+. If you have a previous version, use the examples included with your software. <em>If you see any errors or have comments, please <a href="http://forum.wiring.co/index.php/board,13.0.html">let us know</a>.</em></p>


<div class="example">DynamicKeypad by BREVIG http://alexanderbrevig.com <br />
<br />
 *** THE KEYPAD REQUIRES PULL-UP RESISTORS ON THE ROW PINS. *** * This is a demonstration of keypadEvents. It's used to switch between keymaps while using only one keypad.  The main concepts being demonstrated are: Using the keypad events, PRESSED, HOLD and RELEASED to simplify coding. How to use setHoldTime() and why. Making more than one thing happen with the same key. Assigning and changing keymaps on the fly. <br />
<br />
 Another useful feature is also included with this demonstration although it's not really one of the concepts that I wanted to show you.  If you look at the code in the PRESSED event you will see that the first section of that code is used to scroll through three different letters on each key.  For example, pressing the '2' key will step through the letters 'd', 'e' and 'f'. <br />
<br />
 <br />
<br />
 Using the keypad events, PRESSED, HOLD and RELEASED to simplify coding Very simply, the PRESSED event occurs imediately upon detecting a pressed key and will not happen again until after a RELEASED event.  When the HOLD event fires it always falls between PRESSED and RELEASED.  However, it will only occur if a key has been pressed for longer than the setHoldTime() interval. <br />
<br />
 How to use setHoldTime() and why Take a look at keypad.setHoldTime(500) in the code.  It is used to set the time delay between a PRESSED event and the start of a HOLD event.  The value 500 is in milliseconds (mS) and is equivalent to half a second.  After pressing a key for 500mS the HOLD event will fire and any code contained therein will be executed.  This event will stay active for as long as you hold the key except in the case of bug #1 listed above. <br />
<br />
 Making more than one thing happen with the same key. If you look under the PRESSED event (case PRESSED:) you will see that the '#' is used to print a new line, Serial.println().  But take a look at the first half of the HOLD event and you will see the same key being used to switch back and forth between the letter and number keymaps that were created with alphaKeys[4][5] and numberKeys[4][5] respectively. <br />
<br />
 Assigning and changing keymaps on the fly You will see that the '#' key has been designated to perform two different functions depending on how long you hold it down.  If you press the '#' key for less than the setHoldTime() then it will print a new line.  However, if you hold if for longer than that it will switch back and forth between numbers and letters.  You can see the keymap changes in the HOLD event. <br />
<br />
 <br />
<br />
 In addition... You might notice a couple of things that you won't find in the Arduino language reference.  The first would be #include <ctype.h>.  This is a standard library from the C programming language and though I don't normally demonstrate these types of things from outside the Arduino language reference I felt that its use here was justified by the simplicity that it brings to this sketch. That simplicity is provided by the two calls to isalpha(key) and isdigit(key). The first one is used to decide if the key that was pressed is any letter from a-z or A-Z and the second one decides if the key is any number from 0-9.  The return value from these two functions is either a zero or some positive number greater than zero.  This makes it very simple to test a key and see if it is a number or a letter.  So when you see the following: <br />
<br />
 if (isalpha(key))    // this tests to see if your key was a letter <br />
<br />
 And the following may be more familiar to some but it is equivalent: <br />
<br />
 if (isalpha(key) != 0)   // this tests to see if your key was a letter <br />
<br />
 And Finally... To better understand how the event handler affects your code you will need to remember that it gets called only when you press, hold or release a key.  However, once a key is pressed or held then the event handler gets called at the full speed of the loop(). <br />
<br />
 *** THE KEYPAD REQUIRES PULL-UP RESISTORS ON THE ROW PINS. ***</p>
<p></p>

<p class="doc">
<pre class="code">
#<span class='keyword1'>include</span> &lt;Keypad.h&gt;
#<span class='keyword1'>include</span> &lt;ctype.h&gt;

<span class='comment'>// Define the keymaps.  The blank spot (lower left) is the space character.</span>
<span class='keyword1'>char</span> alphaKeys[4][3] = {
    { 'a','d','g' },
    { 'j','m','p' },
    { 's','v','y' },
    { ' ','.','#' }
};

<span class='keyword1'>char</span> numberKeys[4][3] = {
    { '1','2','3' },
    { '4','5','6' },
    { '7','8','9' },
    { ' ','0','#' }
};

<span class='keyword1'>boolean</span> alpha = <span class='keyword1'>false</span>;   <span class='comment'>// Start with the numeric keypad.</span>

<span class='keyword1'>char</span>* keypadMap = (alpha == <span class='keyword1'>true</span>) ? makeKeymap(alphaKeys) : makeKeymap(numberKeys);

<span class='comment'>// Connect keypad ROW0, ROW1, ROW2 and ROW3 to these pins, eg. ROW0 = Arduino pin2.</span>
<span class='keyword1'>byte</span> rowPins[] = { 9, 8, 7, 6 };

<span class='comment'>// Connect keypad COL0, COL1 and COL2 to these pins, eg. COL0 = Arduino pin6.</span>
<span class='keyword1'>byte</span> colPins[] = { 12, 11, 10 };

<span class='comment'>//create a <span class='keyword1'>new</span> Keypad</span>
Keypad keypad = Keypad(keypadMap, rowPins, colPins, <span class='keyword1'>sizeof</span>(rowPins), <span class='keyword1'>sizeof</span>(colPins));

<span class='keyword1'>const</span> <span class='keyword1'>byte</span> ledPin = 13;	                                                 <span class='comment'>// Use the LED on pin 13.</span>

<span class='keyword1'>void</span> <span class='keyword2'>setup</span>() {
    <span class='keyword1'>Serial</span>.<span class='keyword2'>begin</span>(9600);
    <span class='keyword2'>digitalWrite</span>(ledPin, <span class='literal2'>HIGH</span>);                                                <span class='comment'>// Turns the LED on.</span>
    keypad.addEventListener(keypadEvent);                                      <span class='comment'>// Add an event listener.</span>
    keypad.setHoldTime(500);                                                   <span class='comment'>// Default is 1000mS</span>
    keypad.setDebounceTime(250);                                               <span class='comment'>// Default is 50mS</span>
}

<span class='keyword1'>void</span> <span class='keyword2'>loop</span>() {
    <span class='keyword1'>char</span> key = keypad.getKey();

    <span class='keyword1'>if</span> (alpha) {                      <span class='comment'>// Flash the LED <span class='keyword1'>if</span> we are <span class='keyword2'>using</span> the letter keymap.</span>
        <span class='keyword2'>digitalWrite</span>(ledPin,!<span class='keyword2'>digitalRead</span>(ledPin));
        <span class='keyword2'>delay</span>(100);
    }
}

<span class='comment'>// Take care of some special events.</span>
<span class='keyword1'>void</span> keypadEvent(KeypadEvent key) {
    <span class='keyword1'>static</span> <span class='keyword1'>char</span> virtKey = NO_KEY;      <span class='comment'>// Stores the last <span class='keyword1'>virtual</span> key press. (Alpha keys only)</span>
    <span class='keyword1'>static</span> <span class='keyword1'>char</span> physKey = NO_KEY;      <span class='comment'>// Stores the last physical key press. (Alpha keys only)</span>
    <span class='keyword1'>static</span> <span class='keyword1'>char</span> buildStr[12];
    <span class='keyword1'>static</span> <span class='keyword1'>byte</span> buildCount;
    <span class='keyword1'>static</span> <span class='keyword1'>byte</span> pressCount;

    <span class='keyword1'>switch</span> (keypad.getState())
    {
    <span class='keyword1'>case</span> PRESSED:
        <span class='keyword1'>if</span> (isalpha(key)) {              <span class='comment'>// This is a letter key so we're <span class='keyword2'>using</span> the letter keymap.</span>
            <span class='keyword1'>if</span> (physKey != key) {        <span class='comment'>// New key so start with the first of 3 characters.</span>
                pressCount = 0;
                virtKey = key;
                physKey = key;
            }
            <span class='keyword1'>else</span> {                       <span class='comment'>// Pressed the same key again...</span>
                virtKey++;               <span class='comment'>// so select the next character on that key.</span>
                pressCount++;            <span class='comment'>// Tracks how many times we press the same key.</span>
            }
            <span class='keyword1'>if</span> (pressCount &gt; 2) {        <span class='comment'>// Last character reached so cycle back to start.</span>
                pressCount = 0;
                virtKey = key;
            }
            <span class='keyword1'>Serial</span>.<span class='keyword2'>print</span>(virtKey);       <span class='comment'>// Used <span class='keyword1'>for</span> testing.</span>
        }
        <span class='keyword1'>if</span> (isdigit(key) || key == ' ' || key == '.')  <span class='keyword1'>Serial</span>.<span class='keyword2'>print</span>(key);
        <span class='keyword1'>if</span> (key == '#')  <span class='keyword1'>Serial</span>.<span class='keyword2'>println</span>();
        <span class='keyword1'>break</span>;

    <span class='keyword1'>case</span> HOLD:
        <span class='keyword1'>if</span> (key == '#')  {                   <span class='comment'>// Toggle between keymaps.</span>
            <span class='keyword1'>if</span> (alpha == <span class='keyword1'>true</span>)  {            <span class='comment'>// We are currently <span class='keyword2'>using</span> a keymap with letters</span>
                keypad.<span class='keyword2'>begin</span>(*numberKeys);   <span class='comment'>// and want to change to numbers.</span>
                alpha = <span class='keyword1'>false</span>;
            }
            <span class='keyword1'>else</span>  {                          <span class='comment'>// Or, we are currently <span class='keyword2'>using</span> a keymap with numbers</span>
                keypad.<span class='keyword2'>begin</span>(*alphaKeys);    <span class='comment'>// and want to change to letters.</span>
                alpha = <span class='keyword1'>true</span>;
            }
        }
        <span class='keyword1'>else</span>  {                             <span class='comment'>// Some key other than '#' was pressed.</span>
            buildStr[buildCount++] = (isalpha(key)) ? virtKey : key;
            buildStr[buildCount] = '\0';
            <span class='keyword1'>Serial</span>.<span class='keyword2'>println</span>();
            <span class='keyword1'>Serial</span>.<span class='keyword2'>println</span>(buildStr);
        }
        <span class='keyword1'>break</span>;

    <span class='keyword1'>case</span> RELEASED:
        <span class='keyword1'>if</span> (buildCount &gt;= <span class='keyword1'>sizeof</span>(buildStr))  buildCount = 0;    <span class='comment'>// Our string is full. Start fresh.</span>
        <span class='keyword1'>break</span>;

    }  <span class='comment'>// <span class='keyword2'>end</span> <span class='keyword1'>switch</span>-<span class='keyword1'>case</span></span>
}  <span class='comment'>// <span class='keyword2'>end</span> keypad events</span>
</pre>


</div>


			
			</div>

			<!-- ==================================== FOOTER ============================ --> 
  			<div id="footer">
    			<div id="copyright">Wiring is an open project initiated by <a href="http://barraganstudio.com" target="_blank">Hernando Barrag&aacute;n</a>. It is developed by a <a href="http://wiring.org.co/about.html">small team of volunteers</a>.</div>  
		  <div id="colophon">

                    <a href="../../copyright.html">&copy; Info</a>, Processing <a href="http://processing.org/copyright.html">&copy; Info</a></div>
		  </div>
  			
		</div>
	</body>
</html>
