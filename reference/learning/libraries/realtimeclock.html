<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
	<head>
		<title>RealTimeClock \ Learning \ Wiring</title>
		
		<link rel="icon" href="img/wiring-1.ico" type="image/x-icon" />
		<link rel="shortcut icon" href="img/wiring-1.ico" type="image/x-icon" />
		
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="Author" content="Hernando Barragán" />
		<meta name="Publisher" content="Wiring" />
		<meta name="Keywords" content="Wiring, Processing, Interactive Media, Electronic Arts, Programming, C, C++, Hernando Barragán" />
		<meta name="Description" content="Wiring is an electronic sketchbook and hardware electronics for developing 
				ideas. It is a context for learning fundamentals of computer programming and prototyping with electronics
				within the context of the electronic arts." />
		<meta name="Copyright" content="All contents copyright Hernando Barragán" />
		
		<script src="../../javascript/MM_functions.js" type="text/javascript"></script>
	
		<link href="../../css/style.css" rel="stylesheet" type="text/css" />
	</head>
	<body id="Library" onload="" >
		
		<!-- ==================================== PAGE ============================ --> 
		<div id="container">
	
			<!-- ==================================== HEADER ============================ --> 
			<div id="header">
				<a href="../../index.html"><img src="../../img/wiring_cover.gif" alt="Wiring cover" title="Back to the reference index." /></a>
				<form name="search" method="get" action="http://www.google.com/search">
				<label>Search wiring.org.co:</label> 
				       <p><input type="hidden" name="as_sitesearch" value="wiring.org.co" />
				       <input type="text" name="as_q" value="" size="20" class="text" /> 
						<input type="image" src="../../img/search_button.gif" value="Submit" alt="Submit" /></p>
				</form>
			</div> 
						<div id="navigation">
				<div class="navBar" id="mainnav">
					<a href="../../index.html">Framework</a> (<a href="../../alpha.html">A-Z</a>) \ 
					<a href="../../libraries/index.html">Libraries</a> \ 
					<a href="../../environment/index.html">Environment</a> \ 
					<a href="../../learning/index.html" class="active">Learning</a> \
					<a href="../../hardware/index.html">Hardware</a> 
				</div>
				<div class="navBar learning_local" id="subNav">
					 
 Examples: 					<a href="../../learning/basics/index.html">Basics</a>, 
					<a href="../../learning/libraries/index.html" class="active">Library</a>, 
					<a href="../../learning/topics/index.html">Topics</a> 
				</div>
			</div>

		
			<a id="TOP" name="TOP"></a>
			
			<!-- ==================================== CONTENT - Headers ============================ -->
			<div class="content">
			 
			 
<div class="examples-nav-div">
<table width="480" border="0"><tr><td align="left"><table>
<tr><td><a href="hmc6343sparkfun.html">
				<img src="../../img/back_off.gif" alt="Compass heading with tilt compensation: HMC6352 sparkfun" /></a></td><td>
<select name="nav" size="1" class="inputnav" onChange="javascript:gogo(this)">
	<optgroup label="Wire">
		<option value="digitalpotentiometer.html">Digital potentiometer: AD5171</option>
		<option value="masterreader.html">Master reader</option>
		<option value="masterwriter.html">Master writer</option>
		<option value="slavereceiver.html">Slave receiver</option>
		<option value="slavesender.html">Slave sender</option>
		<option value="ultrasonicsfr.html">Ultrasonic ranger: SFR08/SFR10</option>
		<option value="hmc6352sparkfun.html">Compass heading: HMC6352 sparkfun</option>
		<option value="hmc6343sparkfun.html">Compass heading with tilt compensation: HMC6352 sparkfun</option>
		<option value="realtimeclock.html" selected="selected">Real time clock: DS1307 sparkfun</option>
		<option value="bmp085.html">Temperature and barometric pressure: Sparkfun BOSCH BMP085</option>
		<option value="tmp102sparkfun.html">Temperature: Sparkfun tmp102</option>
	</optgroup>
	<optgroup label="SPI">
		<option value="barometricpressuresensor.html">Barometric pressure: SCP1000</option>
		<option value="gyromlx90609.html">MLX90609 Gyroscope: Sparkfun</option>
	</optgroup>
	<optgroup label="Servo">
		<option value="servomotor.html">Servo moving</option>
		<option value="servomultiple.html">Multiple servos</option>
		<option value="servoanaloginput.html">Servo & potentiometer</option>
	</optgroup>
	<optgroup label="Matrix">
		<option value="hellomatrix.html">Hello Matrix</option>
		<option value="spriteanimation.html">Sprite animation</option>
	</optgroup>
	<optgroup label="LiquidCrystal">
		<option value="printdata.html">Printing data to parallel LCD display</option>
	</optgroup>
	<optgroup label="Encoder">
		<option value="encoderread.html">Encoder read</option>
	</optgroup>
	<optgroup label="EEPROM">
		<option value="storedata.html">Storing data</option>
	</optgroup>
	<optgroup label="EEPROMVar">
		<option value="helloeepromvar.html">EEPROM data variables</option>
	</optgroup>
	<optgroup label="Firmata">
		<option value="allinputsfirmata.html">All inputs</option>
		<option value="analogfirmata.html">Analog inputs</option>
		<option value="echostring.html">Strings accept and echoing</option>
		<option value="i2cfirmata.html">Wire & Firmata</option>
		<option value="oldstandardfirmata.html">Old Standard protocol</option>
		<option value="servofirmata.html">Servo & Firmata</option>
		<option value="simpleanalogfirmata.html">Analog input/output pins</option>
		<option value="simpledigitalfirmata.html">Digital input/output pins</option>
		<option value="standardfirmata.html">Standard protocol</option>
	</optgroup>
	<optgroup label="NewSoftSerial">
		<option value="newsoftserialtest.html">Software serial port test</option>
		<option value="twonsstest.html">Two ports</option>
	</optgroup>
	<optgroup label="Stepper">
		<option value="steppermove.html">Stepper move</option>
	</optgroup>
	<optgroup label="NMEA">
		<option value="basicpositioning.html">Basic positioning</option>
		<option value="coursetodestination.html">Course to destination</option>
		<option value="determiningspeed.html">Determining speed</option>
		<option value="distancetodestination.html">Distance to destination</option>
		<option value="nmeasentence.html">NMEA Sentence</option>
	</optgroup>
	<optgroup label="Button">
		<option value="button.html">Button object</option>
		<option value="eventbutton.html">Event API for buttons</option>
		<option value="pollingcomplexbutton.html">Button polling technique</option>
	</optgroup>
	<optgroup label="Constrain">
		<option value="simpleconstrain.html">Constrained variables</option>
	</optgroup>
	<optgroup label="FluentPrint">
		<option value="hellofluentprint.html">Hello fluent print</option>
	</optgroup>
	<optgroup label="FSM">
		<option value="ledstatemachine.html">LED state machine</option>
	</optgroup>
	<optgroup label="HashMap">
		<option value="hellohashmap.html">Hello Hashmap</option>
	</optgroup>
	<optgroup label="Keypad">
		<option value="customkeypad.html">Custom Keypad</option>
		<option value="dynamickeypad.html">Dynamic Keypad</option>
		<option value="eventkeypad.html">Event Keypad</option>
		<option value="hellokeypad.html">Hello Keypad</option>
	</optgroup>
	<optgroup label="LED">
		<option value="blink.html">Blink</option>
		<option value="loop.html">Loop</option>
	</optgroup>
	<optgroup label="MenuBackend">
		<option value="hellomenu.html">Hello Menu</option>
	</optgroup>
	<optgroup label="OSC">
		<option value="helloosc.html">Hello OSC (Open Sound Control)</option>
	</optgroup>
	<optgroup label="Messenger">
		<option value="basic_communication.html">Basic communication</option>
		<option value="checkstring.html">Check string</option>
		<option value="copystring.html">Copy string</option>
	</optgroup>
	<optgroup label="Password">
		<option value="hellopassword.html">Hello Password</option>
		<option value="passwordkeypad.html">Password Keypad</option>
		<option value="serialmonitor.html">Serial Monitor</option>
	</optgroup>
	<optgroup label="Potentiometer">
		<option value="potcontrol_led.html">PotControl LED</option>
		<option value="potdemo.html">Pot Demo</option>
	</optgroup>
	<optgroup label="Scheduler">
		<option value="delayedsignal.html">Delayed Signal</option>
	</optgroup>
	<optgroup label="Supervisor">
		<option value="hellosupervisor.html">Hello Supervisor</option>
	</optgroup>
	<optgroup label="TimedAction">
		<option value="hellotimedaction.html">Hello Timed Action</option>
		<option value="threeexamplesatonce.html">Three Examples At Once</option>
	</optgroup>
</select>

</td><td><a class="next" href="bmp085.html">
				<img src="../../img/next_off.gif" alt="Temperature and barometric pressure: Sparkfun BOSCH BMP085" /></a></td></tr></table></td></tr></table></div>

<p class="ref-notice">This example is for Wiring version 1.0 build 0100+. If you have a previous version, use the examples included with your software. <em>If you see any errors or have comments, please <a href="http://forum.wiring.co/index.php/board,13.0.html">let us know</a>.</em></p>


<div class="example">RTC Control v.01 by <http://www.combustory.com> John Vaughters Credit to: Maurice Ribble - http://www.glacialwanderer.com/hobbyrobotics for RTC DS1307 code <br />
<br />
 With this code you can set the date/time, retreive the date/time and use the extra memory of an RTC DS1307 chip. The program also sets all the extra memory space to 0xff. Serial Communication method with the Arduino that utilizes a leading CHAR for each command described below. Commands: T(00-59)(00-59)(00-23)(1-7)(01-31)(01-12)(00-99) - T(sec)(min)(hour)(dayOfWeek)(dayOfMonth)(month)(year) - T Sets the date of the RTC DS1307 Chip. Example to set the time for 02-Feb-09 @ 19:57:11 for the 3 day of the week, use this command - T1157193020209 Q(1-2) - (Q1) Memory initialization  (Q2) RTC - Memory Dump On Wiring v1 boards the SCL and SDA pins are: 0 and 1 On Wiring S board the SCL and SDA pins are: 8 and 9</p>
<p></p>

<div class="applet">
	<img src="imgs/RealTimeClock.png"/>
</div>
<p class="doc">
<pre class="code">
#<span class='keyword1'>include</span> &lt;Wire.h&gt;

<span class='keyword1'>int</span> clockAddress = 0x68;  <span class='comment'>// This is the I2C address</span>
<span class='keyword1'>int</span> command = 0;  <span class='comment'>// This is the command <span class='keyword1'>char</span>, in ascii form, sent from the serial port     </span>
<span class='keyword1'>long</span> previousMillis = 0;  <span class='comment'>// will store last time Temp was updated</span>
<span class='keyword1'>byte</span> second, minute, hour, dayOfWeek, dayOfMonth, month, year;
<span class='keyword1'>byte</span> test; 

<span class='comment'>// Convert normal decimal numbers to binary coded decimal</span>
<span class='keyword1'>byte</span> decToBcd(<span class='keyword1'>byte</span> val)
{
  <span class='keyword1'>return</span> ( (val/10*16) + (val%10) );
}

<span class='comment'>// Convert binary coded decimal to normal decimal numbers</span>
<span class='keyword1'>byte</span> bcdToDec(<span class='keyword1'>byte</span> val)
{
  <span class='keyword1'>return</span> ( (val/16*10) + (val%16) );
}

<span class='comment'>// 1) Sets the date and time on the ds1307</span>
<span class='comment'>// 2) Starts the clock</span>
<span class='comment'>// 3) Sets hour mode to 24 hour clock</span>
<span class='comment'>// Assumes you're passing in valid numbers, </span>
<span class='comment'>// Probably need to put in checks <span class='keyword1'>for</span> valid numbers.</span>
<span class='keyword1'>void</span> setDateDs1307()                
{
  <span class='comment'>// Use of (<span class='keyword1'>byte</span>) type casting and ascii math to achieve result.  </span>
  second = (<span class='keyword1'>byte</span>) ((<span class='keyword1'>Serial</span>.<span class='keyword2'>read</span>() - 48) * 10 + (<span class='keyword1'>Serial</span>.<span class='keyword2'>read</span>() - 48)); 
  minute = (<span class='keyword1'>byte</span>) ((<span class='keyword1'>Serial</span>.<span class='keyword2'>read</span>() - 48) *10 +  (<span class='keyword1'>Serial</span>.<span class='keyword2'>read</span>() - 48));
  hour  = (<span class='keyword1'>byte</span>) ((<span class='keyword1'>Serial</span>.<span class='keyword2'>read</span>() - 48) *10 +  (<span class='keyword1'>Serial</span>.<span class='keyword2'>read</span>() - 48));
  dayOfWeek = (<span class='keyword1'>byte</span>) (<span class='keyword1'>Serial</span>.<span class='keyword2'>read</span>() - 48);
  dayOfMonth = (<span class='keyword1'>byte</span>) ((<span class='keyword1'>Serial</span>.<span class='keyword2'>read</span>() - 48) *10 +  (<span class='keyword1'>Serial</span>.<span class='keyword2'>read</span>() - 48));
  month = (<span class='keyword1'>byte</span>) ((<span class='keyword1'>Serial</span>.<span class='keyword2'>read</span>() - 48) *10 +  (<span class='keyword1'>Serial</span>.<span class='keyword2'>read</span>() - 48));
  year= (<span class='keyword1'>byte</span>) ((<span class='keyword1'>Serial</span>.<span class='keyword2'>read</span>() - 48) *10 +  (<span class='keyword1'>Serial</span>.<span class='keyword2'>read</span>() - 48));
  Wire.beginTransmission(clockAddress);
  Wire.<span class='keyword2'>write</span>(<span class='keyword1'>byte</span>(0x00));
  Wire.<span class='keyword2'>write</span>(decToBcd(second));  <span class='comment'>// 0 to <span class='keyword2'>bit</span> 7 starts the clock</span>
  Wire.<span class='keyword2'>write</span>(decToBcd(minute));
  Wire.<span class='keyword2'>write</span>(decToBcd(hour));    <span class='comment'>// If you want 12 hour am/pm you need to set</span>
  <span class='comment'>// <span class='keyword2'>bit</span> 6 (also need to change readDateDs1307)</span>
  Wire.<span class='keyword2'>write</span>(decToBcd(dayOfWeek));
  Wire.<span class='keyword2'>write</span>(decToBcd(dayOfMonth));
  Wire.<span class='keyword2'>write</span>(decToBcd(month));
  Wire.<span class='keyword2'>write</span>(decToBcd(year));
  Wire.endTransmission();
}

<span class='comment'>// Gets the date and time from the ds1307 and prints result</span>
<span class='keyword1'>void</span> getDateDs1307() {
  <span class='comment'>// Reset the register pointer</span>
  Wire.beginTransmission(clockAddress);
  Wire.<span class='keyword2'>write</span>(<span class='keyword1'>byte</span>(0x00));
  Wire.endTransmission();

  Wire.requestFrom(clockAddress, 7);

  <span class='comment'>// A few of these need masks because certain bits are control bits</span>
  second     = bcdToDec(Wire.<span class='keyword2'>read</span>() &amp; 0x7f);
  minute     = bcdToDec(Wire.<span class='keyword2'>read</span>());
  
  <span class='comment'>// Need to change <span class='literal2'><span class='keyword1'>this</span></span> <span class='keyword1'>if</span> 12 hour am/pm</span>
  hour       = bcdToDec(Wire.<span class='keyword2'>read</span>() &amp; 0x3f);  
  dayOfWeek  = bcdToDec(Wire.<span class='keyword2'>read</span>());
  dayOfMonth = bcdToDec(Wire.<span class='keyword2'>read</span>());
  month      = bcdToDec(Wire.<span class='keyword2'>read</span>());
  year       = bcdToDec(Wire.<span class='keyword2'>read</span>());

  <span class='keyword1'>Serial</span>.<span class='keyword2'>print</span>(hour, <span class='literal2'>DEC</span>);
  <span class='keyword1'>Serial</span>.<span class='keyword2'>print</span>(<span class='literal'>":"</span>);
  <span class='keyword1'>Serial</span>.<span class='keyword2'>print</span>(minute, <span class='literal2'>DEC</span>);
  <span class='keyword1'>Serial</span>.<span class='keyword2'>print</span>(<span class='literal'>":"</span>);
  <span class='keyword1'>Serial</span>.<span class='keyword2'>print</span>(second, <span class='literal2'>DEC</span>);
  <span class='keyword1'>Serial</span>.<span class='keyword2'>print</span>(<span class='literal'>"  "</span>);
  <span class='keyword1'>Serial</span>.<span class='keyword2'>print</span>(month, <span class='literal2'>DEC</span>);
  <span class='keyword1'>Serial</span>.<span class='keyword2'>print</span>(<span class='literal'>"/"</span>);
  <span class='keyword1'>Serial</span>.<span class='keyword2'>print</span>(dayOfMonth, <span class='literal2'>DEC</span>);
  <span class='keyword1'>Serial</span>.<span class='keyword2'>print</span>(<span class='literal'>"/"</span>);
  <span class='keyword1'>Serial</span>.<span class='keyword2'>print</span>(year, <span class='literal2'>DEC</span>);

}


<span class='keyword1'>void</span> <span class='keyword2'>setup</span>() {
  Wire.<span class='keyword2'>begin</span>();
  <span class='keyword1'>Serial</span>.<span class='keyword2'>begin</span>(57600);
}

<span class='keyword1'>void</span> <span class='keyword2'>loop</span>() {
  <span class='keyword1'>if</span> (<span class='keyword1'>Serial</span>.<span class='keyword2'>available</span>()) {  <span class='comment'>// Look <span class='keyword1'>for</span> <span class='keyword1'>char</span> in serial que and process <span class='keyword1'>if</span> found</span>
    command = <span class='keyword1'>Serial</span>.<span class='keyword2'>read</span>();
    <span class='keyword1'>if</span> (command == 84) {      <span class='comment'>//If command = <span class='literal'>"T"</span> Set Date</span>
      setDateDs1307();
      getDateDs1307();
      <span class='keyword1'>Serial</span>.<span class='keyword2'>println</span>(<span class='literal'>" "</span>);
    }
    <span class='keyword1'>else</span> <span class='keyword1'>if</span> (command == 81) {  <span class='comment'>//If command = <span class='literal'>"Q"</span> RTC1307 Memory Functions</span>
      <span class='keyword2'>delay</span>(100);     
      <span class='keyword1'>if</span> (<span class='keyword1'>Serial</span>.<span class='keyword2'>available</span>()) {
        command = <span class='keyword1'>Serial</span>.<span class='keyword2'>read</span>(); 
        
        <span class='comment'>// If command = <span class='literal'>"1"</span> RTC1307 Initialize Memory - All Data will be set to 255 (0xff).  </span>
        <span class='comment'>// Therefore 255 or 0 will be an invalid value.  </span>
        <span class='keyword1'>if</span> (command == 49) { 
          
          <span class='comment'>// 255 will be the init value and 0 will be cosidered an error that </span>
          <span class='comment'>// occurs when the RTC is in Battery mode. </span>
          Wire.beginTransmission(clockAddress);
          
          <span class='comment'>// Set the register pointer to be just past the date/time registers.</span>
          Wire.<span class='keyword2'>write</span>(<span class='keyword1'>byte</span>(0x08));  
          <span class='keyword1'>for</span> (<span class='keyword1'>int</span> i = 1; i &lt;= 27; i++) {
            Wire.<span class='keyword2'>write</span>(<span class='keyword1'>byte</span>(0xff));
            <span class='keyword2'>delay</span>(100);
          }   
          Wire.endTransmission();
          getDateDs1307();
          <span class='keyword1'>Serial</span>.<span class='keyword2'>println</span>(<span class='literal'>": RTC1307 Initialized Memory"</span>);
        }
        <span class='keyword1'>else</span> <span class='keyword1'>if</span> (command == 50) {      <span class='comment'>//If command = <span class='literal'>"2"</span> RTC1307 Memory Dump</span>
          getDateDs1307();
          <span class='keyword1'>Serial</span>.<span class='keyword2'>println</span>(<span class='literal'>": RTC 1307 Dump Begin"</span>);
          Wire.beginTransmission(clockAddress);
          Wire.<span class='keyword2'>write</span>(<span class='keyword1'>byte</span>(0x00));
          Wire.endTransmission();
          Wire.requestFrom(clockAddress, 64);
          <span class='keyword1'>for</span> (<span class='keyword1'>int</span> i = 1; i &lt;= 64; i++) {
            test = Wire.<span class='keyword2'>read</span>();
            <span class='keyword1'>Serial</span>.<span class='keyword2'>print</span>(i);
            <span class='keyword1'>Serial</span>.<span class='keyword2'>print</span>(<span class='literal'>":"</span>);
            <span class='keyword1'>Serial</span>.<span class='keyword2'>println</span>(test, <span class='literal2'>DEC</span>);
          }
          <span class='keyword1'>Serial</span>.<span class='keyword2'>println</span>(<span class='literal'>" RTC1307 Dump <span class='keyword2'>end</span>"</span>);
        } 
      }  
    }
    <span class='keyword1'>Serial</span>.<span class='keyword2'>print</span>(<span class='literal'>"Command: "</span>);
    <span class='keyword1'>Serial</span>.<span class='keyword2'>println</span>(command);  <span class='comment'>// Echo command CHAR in ascii that was sent</span>
  }

  command = 0;  <span class='comment'>// reset command                  </span>
  <span class='keyword2'>delay</span>(100);
}
</pre>


</div>


			
			</div>

			<!-- ==================================== FOOTER ============================ --> 
  			<div id="footer">
    			<div id="copyright">Wiring is an open project initiated by <a href="http://barraganstudio.com" target="_blank">Hernando Barrag&aacute;n</a>. It is developed by a <a href="http://wiring.org.co/about.html">small team of volunteers</a>.</div>  
		  <div id="colophon">

                    <a href="../../copyright.html">&copy; Info</a>, Processing <a href="http://processing.org/copyright.html">&copy; Info</a></div>
		  </div>
  			
		</div>
	</body>
</html>
